<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Stock - Calcetines</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <header>
        <h1>ðŸ§¦ Panel de Control - DobleP</h1>
    </header>

    <div class="stats-grid">
        <div class="stat-card" style="border-top-color: #3b82f6;">
            <h3>FacturaciÃ³n Total</h3>
            <p id="facturacion-total" style="color: #3b82f6;">$0.00</p>
        </div>
        <div class="stat-card" style="border-top-color: #10b981;">
            <h3>Ganancia Neta</h3>
            <p id="ganancia-total" style="color: #10b981;">$0.00</p>
        </div>
        <div class="stat-card" style="border-top-color: #f59e0b;">
            <h3>Stock Total</h3>
            <p id="total-items" style="color: #f59e0b;">0</p>
        </div>
    </div>

    <div class="main-content">
        <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h2>Inventario</h2>
        <input type="text" id="buscador" placeholder="ðŸ” Buscar modelo..." 
               style="width: 200px; padding: 8px;" onkeyup="filtrarProductos()">
    </div>
    <table>
                <thead>
                    <tr>
                        <th>Modelo</th>
                        <th>Stock</th>
                        <th>Precio</th>
                        <th>AcciÃ³n</th>
                    </tr>
                </thead>
                <tbody id="tabla-cuerpo"></tbody>
            </table>
        </div>

        <div class="card">
            <h2>Nuevo Producto</h2>
            <div class="input-group"><label>Modelo</label><input type="text" id="nombre"></div>
            <div class="input-group"><label>Cantidad</label><input type="number" id="stock" value="0"></div>
            <div class="input-group"><label>Costo Unitario ($)</label><input type="number" id="costo" value="0" step="0.01"></div>
            <div class="input-group"><label>Precio Venta ($)</label><input type="number" id="venta" value="0" step="0.01"></div>
            <button class="btn btn-add" onclick="agregarProducto()">AÃ±adir Producto</button>
        </div>
    </div>
    <div class="card" style="margin-top: 25px;">
    <h2>Rendimiento Semanal (Ventas $)</h2>
    <div style="height: 300px;">
        <canvas id="graficoVentas"></canvas>
    </div>
</div>
    <div class="card" style="margin-top: 25px;">
        <h2>Historial de Ventas</h2>
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Modelo</th>
                    <th>Venta</th>
                    <th>AcciÃ³n</th>
                </tr>
            </thead>
            <tbody id="historial-cuerpo"></tbody>
        </table>
    </div>
</div>

<div id="modalVenta" class="modal-overlay">
    <div class="modal-content">
        <h3>Registrar Venta</h3>
        <p id="modalVentaProducto" style="font-weight: bold; color: #10b981;"></p>
        <input type="number" id="inputCantidadVenta" placeholder="Cantidad" min="1">
        <div class="modal-buttons">
            <button class="btn btn-sec" onclick="cerrarModales()">Cancelar</button>
            <button class="btn btn-sell" onclick="confirmarVenta()">Confirmar Venta</button>
        </div>
    </div>
</div>

<div id="modalStock" class="modal-overlay">
    <div class="modal-content">
        <h3>Gestionar Unidades</h3>
        <p id="modalProductoNombre" style="font-weight: bold; color: #4f46e5;"></p>
        
        <div class="input-group">
            <label>Cantidad</label>
            <input type="number" id="inputCantidadStock" placeholder="Cantidad" min="1">
        </div>
        
        <div class="input-group" id="groupNuevoCosto" style="margin-top: 10px;">
            <label>Nuevo Costo Unitario (Opcional)</label>
            <input type="number" id="inputNuevoCosto" placeholder="Ej: 1.50" step="0.01">
            <small style="font-size: 0.7rem; color: #64748b;">Si cambiÃ³ el precio de compra, ponlo aquÃ­.</small>
        </div>

        <div class="modal-buttons" style="flex-wrap: wrap;">
            <button class="btn btn-sell" style="flex: 1;" onclick="confirmarCambioStock('sumar')">âž• Sumar</button>
            <button class="btn btn-delete" style="flex: 1;" onclick="confirmarCambioStock('restar')">âž– Restar</button>
            <button class="btn btn-sec" style="width: 100%; margin-top: 5px;" onclick="cerrarModales()">Cancelar</button>
        </div>
    </div>
</div>

<div id="modalEliminar" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color: #ef4444;">Â¿Eliminar Producto?</h3>
        <p>Â¿Seguro quieres borrar <span id="nombreEliminar" style="font-weight: bold;"></span>?</p>
        <div class="modal-buttons">
            <button class="btn btn-sec" onclick="cerrarModales()">Cancelar</button>
            <button class="btn btn-delete" onclick="confirmarEliminar()">Eliminar</button>
        </div>
    </div>
</div>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
<script src="script.js"></script>
</body>
</html>